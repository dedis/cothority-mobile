import React from 'react';
import Tappable from 'react-tappable'

import CothorityWS from '../../services/websocket'
import CothorityMessages from '../../lib/cothority-messages'
import cryptoJS from '../../lib/crypto-js'

import './pop-organizer.css'

export default class PopOrganizer extends React.Component {

    constructor(props) {
        super(props)

        this.state = {
            phase:  0,
            address: '',
            pin: '',
            name: '',
            location:'',
            date: '',
            description: '',
            organizers: ''
        }
    }

    updatePhase(index) {
        this.setState({phase: index})
    }

    //TODO: how do I send a pinRequest?
    contactConode() {
        // Move to next phase
        this.pinPromise = CothorityWS.getStatus(this.state.address)
            .then(() => {this.updatePhase(1)})
            .catch(() => {
                this.setState({address: 'invalid address'})
            });
    }

    //TODO: send PIN message with public key and PIN to the conode
    completePairing() {
        // Move to next phase
        this.updatePhase(2);
    }

    //TODO: send StoreConfig message to the server
    storeConfig() {
        // Move to next phase
        this.updatePhase(3);
    }

    //TODO: generate key pair and save it.
    generateKeyPair() {

    }

    //TODO: start clicable only after inserting address + check address?!?
    renderStartPairing() {
        return (
            <div>
                <h2>Setup Pop Party 1/3</h2>
                <p>
                    Insert the address of a conode and press "Start" in order to
                    begin setting up a PoP party.
                </p>
                    <label>
                        Conode Address:
                        <br/>
                        <input value={this.state.address}
                               onChange={(event) => this.setState({address: event.target.value})} />
                    </label>
                <Tappable className="start_button" onTap={() => this.contactConode()}>Start</Tappable>
            </div>
        )
    }

    //TODO: input only digits, done clicable only after generating keys and inserting PIN
    renderCompletePairing() {
        return (
            <div>
                <h2>Setup Pop Party 2/3</h2>
                <p>
                    Generate a pair of keys (public/private) and insert the PIN generated by the conode
                    in order to accomplish the pairing phase.
                </p>
                <label>
                    PIN:
                    <input type="text" value={this.state.pin}
                           onChange={(event) => this.setState({pin: event.target.value})}/>
                </label>
                <Tappable className="keys_button" onTap={() => this.generateKeyPair()}>
                    Generate Keys
                </Tappable>
                <Tappable className="done_button" onTap={() => this.completePairing()}>
                    Done
                </Tappable>
            </div>
        )
    }

    //TODO: check input, done clicable only if required information have been provided
    renderStoreConfig() {
        return (
            <div>
                <h2>Setup Pop Party 3/3</h2>
                <p>
                    Insert details about the PoP party.
                </p>
                <label>
                    Name:
                    <input type="text" value={this.state.name}
                           onChange={(event) => this.setState({name: event.target.value})}/>
                </label>
                <label>
                    Location:
                    <input type="text" value={this.state.location}
                           onChange={(event) => this.setState({location: event.target.value})}/>
                </label>
                <label>
                    Date:
                    <input type="text" value={this.state.date}
                           onChange={(event) => this.setState({date: event.target.value})}/>
                </label>
                <label>
                    Description:
                    <input type="text" value={this.state.description}
                           onChange={(event) => this.setState({description: event.target.value})}/>
                </label>
                <label>
                    Other organizers:
                    <input type="text" value={this.state.organizers}
                           onChange={(event) => this.setState({organizers: event.target.value})}/>
                </label>
                <Tappable className="done_button" onTap={() => this.storeConfig()} >
                    Done
                </Tappable>
            </div>
        )
    }

    //TODO: show recap of PoP party details
    renderSetupComplete() {
        return (
            <h2>Setup Completed!</h2>
        )
    }

    render() {
        let content = null;
        switch(this.state.phase) {
            case 0:
                content = this.renderStartPairing();
                break;
            case 1:
                content = this.renderCompletePairing();
                break;
            case 2:
                content = this.renderStoreConfig();
                break;
            case 3:
                content = this.renderSetupComplete();
                break;
            default:
                content = this.renderStartPairing();
                break;
        }

        return content;
    }
}